sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,o,t){"use strict";return e.extend("com.binlah.sap.btp.cpi.messageviewer.ext.controller.PayloadViewer",{metadata:{methods:{}},override:{onInit:function(){console.log("LoggingExtension initialized");const e=this.base.getExtensionAPI();console.log("oExtensionAPI:",e)},onAfterRendering:function(){console.log("LoggingExtension after rendering");var e=this.base.getExtensionAPI().getModel();console.log("oModel:",e)},onExit:function(){console.log("LoggingExtension destroyed")},routing:{onAfterBinding:async function(e){console.log("LoggingExtension onAfterBinding");if(!e)return;const t=e.getPath();if(t===this._lastPath)return;this._lastPath=t;if(!this.blobModel){this.blobModel=new o({payload:"",mimeType:""});this.base.getView().setModel(this.blobModel,"blobModel")}await this._loadBlob()}}},_loadBlob:async function(){try{console.log("LoggingExtension _loadBlob");const e=this.base.getView().getBindingContext();if(!e)return;const o=e.getObject();const t=encodeURIComponent(o.Id);const n=this.base.getExtensionAPI().getModel();console.log("oModel:",n);let s=n.getServiceUrl?n.getServiceUrl():n.sServiceUrl||"";console.log("sServiceUrl:",s);if(!s.endsWith("/")){s+="/"}console.log("sServiceUrl:",s);const i=`${s}MessageStoreEntries('${t}')/blob`;console.log("sUrl:",i);const l=await fetch(i,{headers:{Accept:"*/*"},credentials:"include"});if(!l.ok)throw new Error(`${l.status} ${l.statusText}`);const a=(l.headers.get("content-type")||"").toLowerCase();console.log("Fetched blob content-type:",a);let c="";if(a.includes("application/json")){const e=await l.json();c=JSON.stringify(e,null,2)}else if(a.includes("xml")||a.includes("text/")){c=await l.text()}else{const e=await l.arrayBuffer();try{c=new TextDecoder("utf-8").decode(e)}catch(e){c="[binary content not displayable]"}}console.log("Fetched blob:",l);console.log("Fetched blob content:",c);this.blobModel.setData({payload:c,mimeType:a})}catch(e){this.blobModel.setData({payload:`[ERROR]\n${e.message||e}`,mimeType:""})}}})});
//# sourceMappingURL=PayloadViewer.controller.js.map